deploy-gitpod-workspace-image:
  extends:
    # - .rules:code-changes
    - .docker:use-docker-in-docker
  image: docker:git
  stage: post
  before_script:
    - apk add --no-cache jq curl
  script:
    - ./support/docker ci-login
    - cd ./support/gitpod && docker build . --tag "${GITPOD_WORKSPACE_IMAGE}" && docker push "${GITPOD_WORKSPACE_IMAGE}"
  after_script:
    - ./support/docker ci-logout
