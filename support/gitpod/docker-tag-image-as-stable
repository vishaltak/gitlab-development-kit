#!/bin/sh

GITPOD_WORKSPACE_IMAGE_TESTED="${GITPOD_WORKSPACE_IMAGE_BASE:-gitpod-image}:tested"
GITPOD_WORKSPACE_IMAGE_STABLE="${GITPOD_WORKSPACE_IMAGE_BASE:-gitpod-image}:stable"
GITPOD_WORKSPACE_IMAGE_STABLE_OLD="${GITPOD_WORKSPACE_IMAGE_BASE:-gitpod-image}:stable-old"

docker pull "${GITPOD_WORKSPACE_IMAGE_TESTED}"
docker tag "${GITPOD_WORKSPACE_IMAGE_TESTED}" "${GITPOD_WORKSPACE_IMAGE_STABLE}"
docker tag "${GITPOD_WORKSPACE_IMAGE_TESTED}" "${GITPOD_WORKSPACE_IMAGE_STABLE_OLD}"

if [[ "$CI" == "true" ]]; then
  docker push "${GITPOD_WORKSPACE_IMAGE_STABLE}"
  docker push "${GITPOD_WORKSPACE_IMAGE_STABLE_OLD}"
fi
