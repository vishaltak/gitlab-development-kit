#!/bin/sh
GITPOD_WORKSPACE_IMAGE_CURRENT="${GITPOD_WORKSPACE_IMAGE:-gitpod-image}"
GITPOD_WORKSPACE_IMAGE_STABLE="${GITPOD_WORKSPACE_IMAGE_BASE:-gitpod-image}:stable"
GITPOD_WORKSPACE_IMAGE_STABLE_OLD="${GITPOD_WORKSPACE_IMAGE_BASE:-gitpod-image}:gitpod-workspace-image"

docker pull "${GITPOD_WORKSPACE_IMAGE_CURRENT}"
docker tag "${GITPOD_WORKSPACE_IMAGE_CURRENT}" "${GITPOD_WORKSPACE_IMAGE_STABLE}"
docker tag "${GITPOD_WORKSPACE_IMAGE_CURRENT}" "${GITPOD_WORKSPACE_IMAGE_STABLE_OLD}"

if [ "$CI" = "true" ]; then
  docker push "${GITPOD_WORKSPACE_IMAGE_STABLE}"
  docker push "${GITPOD_WORKSPACE_IMAGE_STABLE_OLD}"
fi
