#!/bin/sh
set -e

exec 2>&1
cd <%= service.exec_dir || gdk_root %>

<%= run_env %>

<% service.env.each do |key, value| %>
export <%= key %>="<%= value %>"
<% end %>

# See docs/runit.md#modifying-environment-configuration-for-services
<% env_runit = gdk_root.join('env.runit') %>
test -f <%= env_runit %> && . <%= env_runit %>

# Use chpst -P to run the command in its own process group
exec chpst -P <%= service.command %>
